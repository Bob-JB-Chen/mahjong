

<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üèóÔ∏è VITA MAHJONG PRO</title>
<style>
:root { --t-w: 64px; --t-h: 86px; --bg: #0f172a; }
body { margin: 0; background: var(--bg); font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; color: white; }
#header { width: 100%; padding: 12px; background: #1e293b; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; border-bottom: 2px solid #334155; }
#game-area { position: relative; flex-grow: 1; width: 100%; display: flex; justify-content: center; align-items: center; perspective: 1500px; touch-action: none; }
#board { position: relative; width: 400px; height: 500px; transform: rotateX(15deg); transform-style: preserve-3d; }
.tile { position: absolute; width: var(--t-w); height: var(--t-h); background: #fff; border: 2px solid #000; border-radius: 8px;
display: flex; justify-content: center; align-items: center; font-size: 50px; cursor: pointer; user-select: none;
box-shadow: 0 1px 0 #ccc, 1px 2px 0 #ccc, 2px 3px 0 #bbb, 3px 4px 0 #aaa, 4px 8px 15px rgba(0,0,0,0.6);
transition: transform 0.1s, box-shadow 0.1s; }
.tile.selected { background: #fbbf24; transform: translateZ(15px) scale(1.1); box-shadow: 0 0 20px #fbbf24; z-index: 1000 !important; }
.tile.locked { filter: grayscale(1) brightness(0.4); cursor: not-allowed; }
#footer { padding: 20px; background: #1e293b; width: 100%; display: flex; justify-content: center; gap: 20px; }
.btn { padding: 12px 35px; font-size: 18px; font-weight: bold; border-radius: 50px; border: none; background: #38bdf8; color: #0f172a; cursor: pointer; }
.btn:active { transform: scale(0.95); opacity: 0.8; }
</style>
</head>
<body>
<div id="header">
<span style="font-weight: 800; font-size: 18px;">üèóÔ∏è VITA MAHJONG PRO</span>
<div id="score">Ââ©‰Ωô: <span id="count">0</span></div>
</div>
<div id="game-area"><div id="board"></div></div>
<div id="footer">
<button class="btn" onclick="init()">Êñ∞Ê∏∏Êàè</button>
<button class="btn" style="background: #94a3b8;" onclick="location.reload()">Êâì‰π±</button>
</div>
<script>
const board = document.getElementById('board');
const countEl = document.getElementById('count');
const mahjongs = ['üÄÑ','üÄÖ','üÄÜ','üÄá','üÄà','üÄâ','üÄä','üÄã','üÄå','üÄù','üÄû','üÄü','üÄÄ','üÄÅ','üÄÇ','üÄÉ','üÄê','üÄë','üÄí','üÄì','üÄî','üÄï','üÄñ','üÄó'];
let selected = null; let all = [];

function isLocked(t) {
const {r,c,l} = t.dataset;
const hasUp = all.some(o => o.dataset.l > l && Math.abs(o.dataset.r-r) < 0.8 && Math.abs(o.dataset.c-c) < 0.8);
if(hasUp) return true;
const hasL = all.some(o => o.dataset.l == l && Math.abs(o.dataset.r-r) < 0.5 && o.dataset.c < c && o.dataset.c > c-1.1);
const hasR = all.some(o => o.dataset.l == l && Math.abs(o.dataset.r-r) < 0.5 && o.dataset.c > c && o.dataset.c < c+1.1);
return hasL && hasR;
}

function refresh() {
all.forEach(t => t.classList.toggle('locked', isLocked(t)));
countEl.innerText = all.length;
if(all.length === 0) alert("üèóÔ∏è ÊÅ≠ÂñúÔºÅÂÖ®ÈÉ®ÊåñÂÆåÔºÅ");
}

function handle(t) {
if(t.classList.contains('locked')) return;
if(selected === t) { t.classList.remove('selected'); selected = null; return; }
if(selected) {
if(selected.dataset.v === t.dataset.v) {
t.remove(); selected.remove();
all = all.filter(x => x!==t && x!==selected);
selected = null; refresh();
} else { selected.classList.remove('selected'); t.classList.add('selected'); selected = t; }
} else { t.classList.add('selected'); selected = t; }
}

function init() {
board.innerHTML = ''; all = [];
const layout = [];
// Layer 0: 6x4
for(let r=0;r<6;r++) for(let c=0;c<4;c++) layout.push({r,c,l:0});
// Layer 1: 4x2
for(let r=1;r<5;r++) for(let c=1;c<3;c++) layout.push({r:r+0.2,c:c+0.2,l:1});
// Layer 2: 2x1

for(let r=2;r<4;r++) layout.push({r:r+0.4,c:1.7,l:2});

let pool = [];
let n = Math.floor(layout.length/2);
for(let i=0; i<n; i++) { const v = mahjongs[i % mahjongs.length]; pool.push(v,v); }
if(layout.length % 2) pool.push(mahjongs[0]);
pool.sort(() => Math.random() - 0.5);

layout.forEach((p, i) => {
const t = document.createElement('div'); t.className = 'tile';
t.innerHTML = pool[i]; Object.assign(t.dataset, {v:pool[i], r:p.r, c:p.c, l:p.l});
t.style.left = `${p.c * 72 + 50}px`; t.style.top = `${p.r * 75 + 30}px`;
t.style.transform = `translateZ(${p.l * 12}px)`; t.style.zIndex = p.l * 10;
t.onclick = () => handle(t); board.appendChild(t); all.push(t);
});
refresh();
}
init();
</script>
</body>
</html>

